[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Task",
  "enabled": 1,
  "modified": "2025-12-09 17:48:55.619950",
  "module": null,
  "name": "Restrict Form Fields",
  "script": "\n\nfrappe.ui.form.on('Task', {\n    async refresh(frm) {\n        // Reset all fields to editable first\n        if (frm.fields_dict) {\n            Object.keys(frm.fields_dict).forEach(field => {\n                frm.set_df_property(field, 'read_only', 0);\n            });\n        }\n\n        const logged_in_user = frappe.session.user;\n        let can_edit = false;\n\n        // 1ï¸âƒ£ Check user roles\n        const user_roles = frappe.user_roles || [];\n        const has_admin_or_hr = user_roles.includes(\"Administrator\") || user_roles.includes(\"HR\");\n\n        if (has_admin_or_hr) {\n            can_edit = true;\n        }\n\n        // 2ï¸âƒ£ If not admin/hr, check if user is assigned via employee link\n        if (!can_edit && frm.doc.custom_assigned_to && frm.doc.custom_assigned_to.length > 0) {\n            console.log(\"can edit ...\",can_edit)\n            for (let row of frm.doc.custom_assigned_to) {\n                console.log(\"can employee ...\",row.employee)\n                if (row.employee) {\n                    try {\n                        const r = await frappe.db.get_value(\"Employee\", row.employee, [\"user_id\", \"employee\"]);\n                        console.log(\"ec........\",r)\n                        if (r && r.message && r.message.user_id === logged_in_user) {\n                            can_edit = true;\n                            break;\n                        }\n                    } catch (e) {\n                        console.log(\"Error fetching employee user_id:\", e);\n                    }\n                    \n                    // try {\n                    //     const emp_doc = await frappe.db.get_doc(\"Employee\", row.employee);\n                    //     console.log(\"Employee doc:\", emp_doc);\n                \n                    //     if (emp_doc && emp_doc.user_id === frappe.session.user) {\n                    //         can_edit = true;\n                    //         break;\n                    //     }\n                    // } catch (e) {\n                    //     console.error(\"Error fetching Employee doc:\", e);\n                    // }\n                    \n                }\n            }\n        }\n\n        // 3ï¸âƒ£ Apply read-only if not allowed\n        if (!can_edit) {\n            console.log(\"in edit ....\")\n            Object.keys(frm.fields_dict).forEach(field => {\n                frm.set_df_property(field, 'read_only', 1);\n            });\n        }\n\n        // 4ï¸âƒ£ Child Task logic (only allow limited fields)\n        if (frm.doc.parent_task) {\n            Object.keys(frm.fields_dict).forEach(field => {\n                if (!['status', 'completed_on', 'completed_by'].includes(field)) {\n                    frm.set_df_property(field, 'read_only', 1);\n                }\n            });\n        }\n\n        // 5ï¸âƒ£ Parent Task logic\n        if (frm.doc.is_group) {\n            frm.set_df_property('subject', 'read_only', 1);\n        }\n\n        // 6ï¸âƒ£ Ensure workflow action buttons are visible\n        // frappe.workflow && frappe.workflow.toggle_workflow_actions(frm);\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Order",
  "enabled": 1,
  "modified": "2025-09-24 18:14:47.664870",
  "module": "Buying",
  "name": "Purchase Order Approved Suplier Disply in Supplier",
  "script": "\nfrappe.ui.form.on(\"Purchase Order\", {\n    onload_post_render: function(frm) {\n        frm.set_query(\"supplier\", {\n            filters: {\n                workflow_state: 'Approved'\n            }\n        });\n    }\n});\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Task",
  "enabled": 1,
  "modified": "2025-11-03 20:09:02.297662",
  "module": null,
  "name": "Check work flow of task",
  "script": "frappe.ui.form.on('Task', {\n    refresh: function (frm) {\n        // If Task is Approved or Pending â†’ make form read-only\n        if (frm.doc.workflow_state === \"Approved\" || frm.doc.workflow_state === \"Pending\") {\n            frm.disable_form(true);\n        }\n    },\n\n    before_workflow_action: function(frm) {\n        // Check if workflow action is moving to Pending\n        if (frm.doc.workflow_state === 'Draft') {\n            if (frm.doc.status !== \"Completed\") {\n                frappe.throw(\"Status should be Completed before moving to Pending.\");\n            }\n        }\n    },\n    \n    before_save: function(frm) {\n        frappe.call({\n            method: \"frappe.client.get_value\",\n            args: {\n                doctype: \"Task\",\n                filters: { name: frm.doc.name },\n                fieldname: \"status\"\n            },\n            callback: function(r) {\n                if (r.message) {\n                    let previous_status = r.message.status;\n                    let current_status = frm.doc.status;\n                    frm.__previous_status = r.message.status;\n\n                    console.log(\"Previous (from DB):\", previous_status);\n                    console.log(\"Current (from form):\", current_status);\n\n                }\n            }\n        });\n    },\n    \n    after_save: function(frm) {\n        const previous_status = frm.__previous_status;\n        console.log(\"previous_status .....\",previous_status)\n        console.log(\"frm.doc.status ...\", frm.doc.status, ' .... ', frm.doc.linked_timesheet);\n\n        // âœ… Trigger only when status = Working\n        if (frm.doc.status === \"Working\" && previous_status !=\"Working\") {\n            console.log(\"Task is Working... Checking assigned employees\");\n\n            // Step 1ï¸âƒ£ Get logged-in user's employee record\n            frappe.call({\n                // method: \"frappe.client.get_list\",\n                method: \"emp_list\",\n                // args: {\n                //     doctype: \"Employee\",\n                //     filters: { user_id: frappe.session.user },\n                //     fields: [\"name\"]\n                // },\n                callback: function(res) {\n                    if (!res.message || res.message.length === 0) {\n                        frappe.msgprint(\"No Employee linked to this user\");\n                        return;\n                    }\n\n                    let logged_in_employee = res.message;\n                    console.log(\"Logged in employee:\", logged_in_employee, \"......,\",res.message);\n\n                    // Step 2ï¸âƒ£ Check if logged-in employee is assigned to this task\n                    let assigned_employees = (frm.doc.custom_assigned_to || []).map(row => row.employee);\n                    if (!assigned_employees.includes(logged_in_employee)) {\n                        console.log(\"Logged-in employee not assigned to this Task\");\n                        return;\n                    }\n\n                    // Step 3ï¸âƒ£ Check if Timesheet already exists for this employee & today's date\n                    frappe.call({\n                        method: \"frappe.client.get_list\",\n                        args: {\n                            doctype: \"Timesheet\",\n                            filters: {\n                                employee: logged_in_employee,\n                                start_date: frappe.datetime.nowdate()\n                            },\n                            fields: [\"name\"]\n                        },\n                        callback: function(ts_res) {\n                            console.log(\"ts_res.message .....\",ts_res.message, ' ......',ts_res)\n                            if (ts_res.message && ts_res.message.length > 0) {\n                                // âœ… Timesheet exists â€” add new time log\n                                let timesheet_name = ts_res.message[0].name;\n                                console.log(\"Existing Timesheet found:\", timesheet_name);\n\n                                frappe.call({\n                                    method: \"frappe.client.get\",\n                                    args: {\n                                        doctype: \"Timesheet\",\n                                        name: timesheet_name\n                                    },\n                                    callback: function(get_res) {\n                                        if (!get_res.message) return;\n                                        let ts = get_res.message;\n\n                                        // Check if this task already logged today\n                                        let already_logged = (ts.time_logs || []).some(\n                                            log => log.task === frm.doc.name\n                                        );\n\n                                        // âœ… Add new log entry for this task\n                                        ts.time_logs.push({\n                                            activity_type: \"Task Work\",\n                                            from_time: frappe.datetime.now_datetime(),\n                                            task: frm.doc.name\n                                        });\n\n                                        frappe.call({\n                                            method: \"frappe.client.save\",\n                                            args: { doc: ts },\n                                            callback: function(save_res) {\n                                                frappe.msgprint(\"Task added to existing Timesheet\");\n                                            }\n                                        });\n                                    }\n                                });\n                            } else {\n                                // âŒ No timesheet found â†’ Create new one\n                                console.log(\"Creating new Timesheet...\");\n                                frappe.call({\n                                    method: \"frappe.client.insert\",\n                                    args: {\n                                        doc: {\n                                            doctype: \"Timesheet\",\n                                            employee: logged_in_employee,\n                                            start_date: frappe.datetime.nowdate(),\n                                            time_logs: [\n                                                {\n                                                    activity_type: \"Task Work\",\n                                                    from_time: frappe.datetime.now_datetime(),\n                                                    task: frm.doc.name\n                                                }\n                                            ]\n                                        }\n                                    },\n                                    callback: function(insert_res) {\n                                        if (!insert_res.exc) {\n                                            let timesheet = insert_res.message;\n                                            frappe.msgprint(__(\"New Timesheet created for today.\"));\n\n                                            // âœ… Save Timesheet ID back to Task\n                                            frappe.call({\n                                                method: \"frappe.client.set_value\",\n                                                args: {\n                                                    doctype: \"Task\",\n                                                    name: frm.doc.name,\n                                                    fieldname: \"linked_timesheet\",\n                                                    value: timesheet.name\n                                                }\n                                            });\n                                        }\n                                    }\n                                });\n                            }\n                        }\n                    });\n                }\n            });\n        }\n        \n        if (frm.doc.status === \"Completed\" || frm.doc.status === \"Stopped\") {\n            let now = frappe.datetime.now_datetime();\n        \n            // Get all Timesheets (only parent fields first)\n            frappe.call({\n                method: \"frappe.client.get_list\",\n                args: {\n                    doctype: \"Timesheet\",\n                    filters: [],\n                    fields: [\"name\"],  // only fetch name here\n                },\n                callback: function(ts_list) {\n                    ts_list.message.forEach(ts => {\n                        // Fetch full Timesheet including child table\n                        frappe.call({\n                            method: \"frappe.client.get\",\n                            args: {\n                                doctype: \"Timesheet\",\n                                name: ts.name\n                            },\n                            callback: function(ts_full) {\n                                let timesheet = ts_full.message;\n                                if (!timesheet.time_logs) return;\n        \n                                let updated = false;\n        \n                                timesheet.time_logs.forEach(log => {\n                                    let task_completed=log.completed\n                                    if (log.task === frm.doc.name && !task_completed) {\n                                        log.to_time = now;\n                                        log.completed = true;\n        \n                                        if (log.from_time && log.to_time) {\n                                            let from_dt = frappe.datetime.str_to_obj(log.from_time);\n                                            let to_dt = frappe.datetime.str_to_obj(log.to_time);\n        \n                                            let diff_ms = to_dt - from_dt;\n                                            let diff_hours = diff_ms / (1000 * 60 * 60);\n                                            log.hours = diff_hours.toFixed(2);\n                                        }\n        \n                                        updated = true;\n                                    }\n                                });\n        \n                                if (updated) {\n                                    frappe.call({\n                                        method: \"frappe.client.save\",\n                                        args: { doc: timesheet },\n                                        callback: function() {\n                                            frappe.msgprint(__(\"Stop time updated in Timesheet for Task \" + frm.doc.name));\n                                        }\n                                    });\n                                }\n                            }\n                        });\n                    });\n                }\n            });\n        }\n\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Request for Quotation",
  "enabled": 1,
  "modified": "2025-11-27 12:09:00.073093",
  "module": null,
  "name": "Add supplier group and item filter in RFQ",
  "script": "frappe.ui.form.on('Request for Quotation', {\n    refresh: function (frm, cdt, cdn){\n        if (frm.doc.docstatus === 1) {\n\t\t\tfrm.add_custom_button(__('Update After Submit'), function() {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"unlock_rfq_after_submit\",\n\t\t\t\t\targs: { rfq_name: frm.doc.name },\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t// Mark document as draft again (docstatus=0)\n\t\t\t\t\t\t\tfrm.doc.docstatus = 0;\n\t\t\t\t\t\t\tfrm.reload_doc();\n\n\t\t\t\t\t\t\tfrappe.msgprint(\"Form unlocked for editing.\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\t\n\t\t// Apply filter to child table link field\n        frm.set_query(\"supplier\", \"suppliers\", function() {\n            return {\n                filters: {\n                    workflow_state: \"Approved\"\n                }\n            };\n        });\n    },\n    \n    custom_supplier_group: function(frm) {\n        if (frm.doc.custom_supplier_group) {\n            frappe.call({\n                method: \"rfq_suppliers_api\", // â† use Server Script name\n                args: { supplier_group: frm.doc.custom_supplier_group },\n                callback: function(r) {\n                    if (r.message) {\n                        let has_records = frm.doc.suppliers && frm.doc.suppliers.length > 0;\n                        let only_blank_row =\n                            has_records && frm.doc.suppliers.length === 1 && !frm.doc.suppliers[0].supplier;\n\n                        if (has_records && !only_blank_row) {\n                            frappe.confirm(\n                                \"This will remove existing suppliers. Do you want to continue?\",\n                                function() {\n                                    frm.clear_table(\"suppliers\");\n                                    r.message.forEach(function(supp) {\n                                        let row = frm.add_child(\"suppliers\");\n                                        console.log('r.supp ...',supp, JSON.stringfy(supp))\n                                        row.supplier = supp.name;\n                                        row.supplier_name = supp.supplier_name;\n                                        row.contact = supp.supplier_primary_contact;\n                                        row.email_id = supp.email_id;\n                                        \n                                    });\n                                    frm.refresh_field(\"suppliers\");\n                                }\n                            );\n                        } else {\n                            console.log('r.message ...',r.message)\n                            frm.clear_table(\"suppliers\");\n                            r.message.forEach(function(supp) {\n                                let row = frm.add_child(\"suppliers\");\n                                \n                                row.supplier = supp.name;\n                                row.supplier_name = supp.supplier_name;\n                                row.contact = supp.supplier_primary_contact;\n                                row.email_id = supp.email_id;\n                            });\n                            frm.refresh_field(\"suppliers\");\n                        }\n                    }\n                }\n            });\n        }\n    },\n    \n    custom_item: function(frm) {\n        if (frm.doc.custom_item) {\n            frappe.call({\n                method: \"get_suppliers_by_item\",\n                args: {\n                    item: frm.doc.custom_item\n                },\n                callback: function(r) {\n                    if (r.message) {\n                        console.log(\"in vsjdk ....\",r.message)\n                        r.message.forEach(supplier => {\n                            let has_records = frm.doc.suppliers && frm.doc.suppliers.length > 0;\n                            let only_blank_row = has_records && frm.doc.suppliers.length === 1 && !frm.doc.suppliers[0].supplier;\n        \n                            // Clear table only if there's a single blank row\n                            if (only_blank_row) {\n                                frm.clear_table(\"suppliers\");\n                            }\n                            // Avoid duplicates\n                            let exists = frm.doc.suppliers.some(s => s.supplier === supplier.supplier);\n                            if (!exists) {\n                                let child = frm.add_child(\"suppliers\");\n                                console.log('supplier ...',supplier.supplier)\n                                // child.supplier = supplier.supplier;\n                                \n                                child.supplier = supplier.name;\n                                child.supplier_name = supplier.supplier_name;\n                                child.contact = supplier.supplier_primary_contact;\n                                child.email_id = supplier.email_id;\n                            }\n                        });\n                        frm.refresh_field(\"suppliers\");\n                    }\n                }\n            });\n        }\n    },\n    \n    onload: function(frm) {\n        // Only populate if the table is empty\n        if (!frm.doc.custom_rfq_terms || frm.doc.custom_rfq_terms.length === 0) {\n            frappe.call({\n                method: \"frappe.client.get_list\",\n                args: {\n                    doctype: \"Terms and Conditions\",          // The Doctype linked in the child table field\n                    filters: { custom_is_default: 1 }, // Only default terms\n                    fields: [\"name\"]            // We only need the document name for a Link field\n                },\n                callback: function(r) {\n                    if (r.message) {\n                        frm.clear_table(\"custom_rfq_terms\");\n                        r.message.forEach(function(term) {\n                            let row = frm.add_child(\"custom_rfq_terms\");\n                            row.terms = term.name; // Set Link field to document name\n                        });\n                        frm.refresh_field(\"custom_rfq_terms\");\n                        \n                        // âœ… Call refresh_terms to update parent 'terms' field\n                        refresh_terms(frm);\n                    }\n                }\n            });\n        }\n    }\n});\n\n\nfrappe.ui.form.on('RFQ Terms Table', {\n\tterms: function(frm, cdt, cdn) {\n\t    console.log('nncnjcjdj...')\n        refresh_terms(frm);\n    },\n    add_multiple_terms_remove: function(frm, cdt, cdn) {\n        refresh_terms(frm);\n    }\n})\n\nfunction refresh_terms(frm) {\n    console.log(\"frm ...........vmweo\")\n    let combined_terms = \"\";\n    let rows = frm.doc.custom_rfq_terms || [];\n\n    if (!rows.length) {\n        frm.set_value(\"terms\", \"\");\n        return;\n    }\n\n    // Collect all term names first\n    let term_names = rows.map(row => row.terms).filter(Boolean);\n    term_names = term_names.filter((value, index, array) => array.indexOf(value) === index);\n    if (!term_names.length) {\n        frm.set_value(\"terms\", \"\");\n        return;\n    }\n\n    // Fetch all terms in one call (keeps sequence)\n    frappe.db.get_list(\"Terms and Conditions\", {\n        filters: { name: [\"in\", term_names] },\n        fields: [\"name\", \"title\", \"terms\"]\n    }).then(result => {\n        let count = 1;\n\n        // Loop rows in same sequence as child table\n        rows.forEach(row => {\n            let term = result.find(r => r.name === row.terms);\n            if (term) {\n                combined_terms += `<b>${count}. ${term.title}</b><br/>${term.terms}<br/><br/>`;\n                count++;\n            }\n        });\n\n        frm.set_value(\"terms\", combined_terms.trim());\n    });\n}\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Supplier",
  "enabled": 1,
  "modified": "2025-11-14 12:06:51.728963",
  "module": null,
  "name": "Hide fields for Pre Supplier Role",
  "script": "frappe.ui.form.on(\"Supplier\", {\n    onload(frm) {\n        const roles = (frappe.boot.user && frappe.boot.user.roles) || [];\n        console.log(\"roles /////...\", roles);\n\n        if (roles.includes(\"Pre Supplier\") && !roles.includes(\"Administrator\")) {\n            console.log(\"in if ..........\");\n\n            // Hide form fields and sections\n            frm.set_df_property(\"defaults_section\", \"hidden\", 1);\n            frm.set_df_property(\"settings_tab\", \"hidden\", 1);\n            frm.set_df_property(\"block_supplier_section\", \"hidden\", 1);\n            frm.set_df_property(\"portal_users_tab\", \"hidden\", 1);\n            frm.set_df_property(\"internal_supplier_section\", \"hidden\", 1);\n            frm.set_df_property(\"primary_address_and_contact_detail_section\", \"hidden\", 1);\n            \n\n            // Hide tabs by label (only inside the form)\n            setTimeout(() => {\n                frm.$wrapper.find(\".page-icon-group.hidden-xs.hidden-sm\").hide();\n                frm.$wrapper.find(\".inner-group-button\").hide();\n                console.log(\"ðŸš« Hidden page-icon-group (Prev/Next/Print) for Pre Supplier\");\n        \n                const tabs_to_hide = [\"Settings\", \"Defaults\", \"Portal Users\"];\n                tabs_to_hide.forEach(label => {\n                    frm.$wrapper.find(`.form-tabs .nav-link:contains(${label})`).closest(\"li\").hide();\n                });\n            }, 200);\n            \n            // Hide icon group (Previous, Next, Print)\n  \n\n            // Remove menu and toolbar only inside this form\n            frm.page.clear_menu();\n            frm.page.clear_inner_toolbar();\n            \n            \n\n            // Hide form-specific buttons safely\n            setTimeout(() => {\n                const buttons_to_hide = [\n                    \"Ledger\",\n                    \"Accounting Entries\",\n                    \"Accounts Receivable\",\n                    \"General Ledger\",\n                    \"Bank Reconciliation\",\n                    \"View\",\n                    \"Create\"\n                ];\n\n                buttons_to_hide.forEach(label => {\n                    // Restrict search to this formâ€™s area only ðŸ‘‡\n                    frm.$wrapper.find(`button:contains(${label})`).hide();\n                    frm.$wrapper.find(`.btn:contains(${label})`).hide();\n                });\n            }, 500);\n        }\n    },\n// });\n\n\n// frappe.ui.form.on(\"Supplier\", {\n    refresh(frm) {\n        const roles = frappe.user_roles || [];\n        if (!roles.includes(\"Pre Supplier\")) return;\n        \n        // --- Hide all unwanted buttons ---\n        function hideButtons() {\n            const wrapper = frm.$wrapper;\n\n            // Hide page actions (View, Create, Action, etc.)\n            wrapper.find('.page-actions button').hide();\n            wrapper.find('.page-actions .btn').hide();\n            wrapper.find('.custom-actions button').hide();\n            wrapper.find('.actions-btn-group button').hide();\n\n            // Clear menu and action dropdowns\n            frm.page.clear_menu();\n            frm.page.clear_inner_toolbar();\n            frm.page.clear_actions_menu();\n\n            console.log(\"ðŸš« All toolbar buttons hidden for Pre Supplier\");\n        }\n\n        // Function to find and update the badge instantly\n        const updateBadgeInstantly = () => {\n            const badge = document.querySelector('.indicator-pill.red span');\n            if (badge && /rejected/i.test(badge.textContent.trim())) {\n                badge.textContent = \" Pending\";\n                const pill = badge.closest('.indicator-pill');\n                pill.classList.remove('red');\n                pill.classList.add('orange');\n                console.log(\"âœ… Changed workflow badge to Pending (instant)\");\n            }\n        };\n\n        // Observe the header for workflow badge rendering\n        const header = frm.$wrapper.find('.page-head')[0];\n        if (!header) return;\n\n        const observer = new MutationObserver(() => {\n            const badge = document.querySelector('.indicator-pill.red span');\n            if (badge) {\n                updateBadgeInstantly();\n                observer.disconnect(); // stop watching after first change\n            }\n        });\n\n        // Start watching for changes in header area\n        observer.observe(header, { childList: true, subtree: true });\n\n        // Safety: also run once after small delay in case itâ€™s already rendered\n        setTimeout(updateBadgeInstantly, 100);\n        \n        // Hide form-specific buttons safely\n        setTimeout(() => {\n            const buttons_to_hide = [\n                \"Ledger\",\n                \"Accounting Entries\",\n                \"Accounts Receivable\",\n                \"General Ledger\",\n                \"Bank Reconciliation\",\n                \"View\",\n                \"Create\",\n                \"Menu\",\n            ];\n\n            buttons_to_hide.forEach(label => {\n                // Restrict search to this formâ€™s area only ðŸ‘‡\n                frm.$wrapper.find(`button:contains(${label})`).hide();\n                frm.$wrapper.find(`.btn:contains(${label})`).hide();\n            });\n        }, 500);\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Supplier",
  "enabled": 1,
  "modified": "2025-11-13 17:53:39.118210",
  "module": null,
  "name": "Supplier list filter",
  "script": "frappe.listview_settings['Supplier'] = {\n    onload: function(listview) {\n        frappe.after_ajax(() => {\n             $('.filter-selector').hide();\n        });\n    }\n};\n",
  "view": "List"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Address",
  "enabled": 1,
  "modified": "2025-11-09 10:55:12.275786",
  "module": null,
  "name": "Hide address fields for pre supplier login",
  "script": "frappe.ui.form.on(\"Address\", {\n    onload(frm) {\n        const roles = (frappe.boot.user && frappe.boot.user.roles) || [];\n        if (roles.includes(\"Pre Supplier\") && !roles.includes(\"Administrator\")) {\n            frm.set_df_property(\"linked_with\", \"hidden\", 1);\n            frm.set_df_property(\"is_primary_address\", \"hidden\", 1);\n            frm.set_df_property(\"is_shipping_address\", \"hidden\", 1);\n            frm.set_df_property(\"disabled\", \"hidden\", 1);\n        }\n    },\n\n    after_save(frm) {\n        console.log(\"in save .....\")\n        const roles = (frappe.boot.user && frappe.boot.user.roles) || [];\n        if (roles.includes(\"Pre Supplier\") && !roles.includes(\"Administrator\")) {\n            frappe.show_alert({\n                message: __(\"Address updated successfully. Redirecting...\"),\n                indicator: \"green\",\n            });\n\n            // ðŸ”¹ Redirect to whatever URL you have stored or currently in location\n            // Example 1: Go back to previous page\n            window.history.back();\n\n            // OR Example 2: If you already know supplier URL in current location, re-use it\n            // window.location.href = window.location.origin + \"/app/supplier\";\n        }\n    },\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Request for Quotation",
  "enabled": 1,
  "modified": "2025-11-13 17:45:32.723045",
  "module": null,
  "name": "Add attachment type filter in RFQ",
  "script": "frappe.ui.form.on('Request for Quotation', {\n    refresh(frm) {\n        // Limit attachment_type options in the child table\n        frm.fields_dict['custom_addendum'].grid.update_docfield_property(\n            'attachment_type',\n            'options',\n            ['Technical', 'Terms and Conditions']\n        );\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Order",
  "enabled": 1,
  "modified": "2025-12-09 17:54:25.711448",
  "module": null,
  "name": "Add Print Button",
  "script": "\nfrappe.ui.form.on(\"Purchase Order\", {\n    refresh(frm) {\n\n        // Remove only the default PDF option from Print Menu\n        frm.page.clear_menu();\n\n        // Add custom button into right-side custom actions area\n        add_custom_pdf_button(frm);\n    }\n});\n\nfunction add_custom_pdf_button(frm) {\n    // Wait for DOM to load\n    setTimeout(() => {\n\n        // Find custom action container\n        const action_container = frm.page.wrapper.find(\".custom-actions.hidden-xs.hidden-md\");\n\n        if (!action_container.length) return;\n\n        // Remove existing button (if refresh)\n        action_container.find(\".btn-custom-po-pdf\").remove();\n\n        // Create button\n        const btn = $(`\n            <button class=\"btn btn-default btn-xs btn-custom-po-pdf\" style=\"margin-left: 8px;\">\n                <i class=\"fa fa-file-pdf-o\"></i> PDF\n            </button>\n        `);\n\n        // Add click event\n        btn.on(\"click\", function () {\n            frappe.call({\n                method: \"reva_erp.api.po_pdf.download_po_pdf\",\n                args: { purchase_order_name: frm.doc.name },\n                freeze: true,\n                freeze_message: \"Generating PDF...\",\n                callback: function (r) {\n                    if (r.message) {\n                        window.open(r.message, \"_blank\");\n                    }\n                }\n            });\n        });\n\n        // Append to action container\n        action_container.append(btn);\n\n    }, 300);\n}\n",
  "view": "Form"
 }
]